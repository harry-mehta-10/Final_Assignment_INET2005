generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL") // Adjust for your database URL
}

model Customer {
  id            Int        @id @default(autoincrement())
  email         String     @unique
  first_name    String
  last_name     String
  password      String
  purchases     Purchase[] // Relation to Purchase
}

model Product {
  id            Int        @id @default(autoincrement())
  name          String
  description   String
  cost          Float
  image         String
  purchaseItems PurchaseItem[] // Relation to PurchaseItem
}

model Purchase {
  purchase_id    Int      @id @default(autoincrement()) 
  customer_id    Int
  street         String
  city           String
  province       String
  country        String
  postal_code    String
  credit_card    String
  credit_expire  String
  credit_cvv     String
  order_date     DateTime @default(now())
  
  // Nullable fields for invoice amounts
  invoice_amt    Float?   // Make it nullable
  invoice_tax    Float?   // Make it nullable
  invoice_total  Float?   // Make it nullable
  
  customer       Customer @relation(fields: [customer_id], references: [id])
  items          PurchaseItem[]

  @@index([customer_id])
}

model PurchaseItem {
  purchase_id    Int
  product_id     Int
  quantity       Int

  purchase       Purchase @relation(fields: [purchase_id], references: [purchase_id])
  product        Product  @relation(fields: [product_id], references: [id])

  @@id([purchase_id, product_id]) // Composite key
}
